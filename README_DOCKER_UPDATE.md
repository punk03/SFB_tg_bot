# Инструкция по обновлению Docker-контейнера бота СФБ

В этом документе описаны процедуры обновления Docker-контейнера с использованием скриптов `update_docker.sh` (для Linux/macOS) и `update_docker.bat` (для Windows).

## Что делают скрипты обновления

Скрипты выполняют следующие действия:

1. Проверяют, установлен ли Docker на компьютере
2. Создают рабочую директорию, если она еще не существует
3. Клонируют репозиторий с GitHub или обновляют его, если он уже существует
4. Сохраняют существующие токены и ID из .env файла или предлагают ввести новые
5. Создают файл .env с правильной кодировкой UTF-8 и сохраненными токенами
6. Останавливают и удаляют существующий контейнер
7. Удаляют старый образ Docker
8. Собирают и запускают новый контейнер с обновленными файлами
9. Проверяют успешность запуска контейнера
10. Предлагают просмотреть логи запущенного бота

## Запуск скрипта на Linux/macOS

```bash
# Сделать скрипт исполняемым (один раз)
chmod +x update_docker.sh

# Запустить скрипт
./update_docker.sh
```

## Запуск скрипта на Windows

```
# Запустить скрипт двойным кликом или из командной строки
update_docker.bat
```

## Важные замечания

### 1. Настройка переменных в скриптах

Скрипты содержат следующие переменные, которые можно изменить при необходимости:

- `REPO_URL` - URL репозитория на GitHub
- `PROJECT_DIR` - директория, где будет установлен проект
- `CONTAINER_NAME` - имя Docker-контейнера
- `ADMIN_IDS` - ID администраторов (по умолчанию: 771824107)

### 2. Требования

- Установленный Docker
- Установленный Git
- В Linux: права на запуск Docker без sudo
- В Windows: PowerShell или командная строка с правами администратора

### 3. Восстановление данных

Скрипт автоматически сохраняет и восстанавливает данные из файла .env, если он существует:

- TG_BOT_TOKEN
- VK_TOKEN
- TG_GROUP_ID
- VK_GROUP_ID

Если файл .env не найден, скрипт предложит ввести эти значения вручную.

## Устранение проблем

Если возникают проблемы при запуске контейнера, скрипт предложит проверить журналы Docker:

```bash
# Linux/macOS
docker logs sfb_bot

# Windows
docker logs sfb_bot
```

Если контейнер не запускается, убедитесь, что все токены и ID в файле .env указаны правильно.

## Ручное запуск Docker-контейнера

Если скрипт не работает по какой-то причине, можно запустить контейнер вручную:

```bash
# Перейти в директорию проекта
cd /opt/sfb_bot  # для Linux
cd C:\sfb_bot  # для Windows

# Запустить Docker Compose
docker-compose up --build -d
``` 